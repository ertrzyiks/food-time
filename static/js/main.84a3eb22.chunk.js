(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{110:function(e,t,a){e.exports=a(143)},115:function(e,t,a){},142:function(e,t,a){},143:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(23),o=a.n(c),i=(a(115),a(20)),l=a(37),u=a(36),m=a(63),s=a(39),d=a(105),f=a(25),p=a(26),E=a.n(p),b=a(191),g=a(180),v=a(181),h=a(182),O=a(50),y=a(183),j=a(49),w=a.n(j),k=a(107),x=a(184),N=a(185),I=a(175),S=a(173),C=a(174),_=a(186),D=a(171),$=a(190),z=a(172),A=Object(D.a)(function(e){return{error:{backgroundColor:e.palette.error.dark}}}),M=function(e){var t=e.message,a=Object(n.useState)(!0),c=Object(i.a)(a,2),o=c[0],l=c[1],u=A();if(!t)return null;function m(e,t){"clickaway"!==t&&l(!1)}return t.networkError&&t.networkError.result&&t.networkError.result.errors&&t.networkError.result.errors.length>0&&(t=t.networkError.result.errors[0].message.slice(0,100)),r.a.createElement($.a,{anchorOrigin:{vertical:"bottom",horizontal:"left"},autoHideDuration:6e3,onClose:m,open:o},r.a.createElement(z.a,{className:u.error,message:t.toString(),onClose:m}))},R=a(178),T=a(176),W=a(177),F=a(179),q=a(92),H=a.n(q),L=a(90),B=a.n(L),G=a(53),J=a(87),Q=a(88);function P(e){return Object(G.a)(new Date(e),"HH:mm")}function U(e,t){var a=Object(J.a)(e,t),n=Object(Q.a)(e,t)%60;return n<10&&(n="0".concat(n)),"".concat(a,":").concat(n,"h")}var K=a(89);var V=Object(D.a)(function(e){return{item:{opacity:.3},root:{backgroundColor:e.palette.background.paper},subheader:{backgroundColor:"#f0f2fa",color:e.palette.common.black,textAlign:"left"},subheader_total:{float:"right"},icon_wrapper:{display:"flex",flexDirection:"column",fontSize:12}}}),X=function(e){var t=e.time,a=e.key,c=Object(n.useState)(0),o=Object(i.a)(c,2),l=o[0],u=o[1];!function(e,t){var a=Object(n.useRef)();Object(n.useEffect)(function(){a.current=e},[e]),Object(n.useEffect)(function(){if(null!==t){var e=setInterval(function(){a.current()},t);return function(){return clearInterval(e)}}},[t])}(function(){u(l+1)},15e3);var m=Date.now(),s=V(),d=new Date(1e3*t);return r.a.createElement(S.a,{key:a,className:s.item},r.a.createElement(C.a,{primary:"Next at ".concat(P(d)),secondary:d>m&&U(d,m)}))},Y=function(){return null},Z=function(e){var t=e.groupedEntries,a=Date.now(),n=V();return r.a.createElement(I.a,{disablePadding:!0,className:n.root},Object.entries(t).map(function(e){var t=Object(i.a)(e,2),c=t[0],o=t[1];return r.a.createElement(K.CSSTransitionGroup,{key:c,transitionName:"example",transitionEnterTimeout:500,transitionLeaveTimeout:300},r.a.createElement(T.a,{className:n.subheader},Object(G.a)(parseInt(c,10),"d MMM, yyyy"),r.a.createElement("span",{className:n.subheader_total},"(total ",function(e){return e.filter(function(e){return!e.isSuggested}).length}(o),")")),o.map(function(e){var t=e.id,c=e.time,o=e.extra_food,i=e.meantime;return e.isSuggested?r.a.createElement(X,{key:t,time:c}):r.a.createElement(S.a,{key:t},r.a.createElement(W.a,null,o>0?r.a.createElement("div",{className:n.icon_wrapper},r.a.createElement(B.a,null)," ",o,"ml"):r.a.createElement(Y,null)),r.a.createElement(C.a,{secondary:i},P(1e3*c)),r.a.createElement(R.a,null,a-1e3*c<864e5&&r.a.createElement(F.a,{edge:"end","aria-label":"Comments",component:l.b,to:"/edit/".concat(t)},r.a.createElement(H.a,null))))}))}))},ee=a(98),te=a(46);function ae(){var e=Object(f.a)(["\n  query getEntries($spaceId: String!) {\n    entries(spaceId: $spaceId) {\n      id\n      time\n      extra_food\n      spaceId\n    }\n  }\n"]);return ae=function(){return e},e}var ne=E()(ae());function re(){var e=Object(f.a)(["\n  query getEntry($id: String!) {\n    entry(id: $id) {\n      id\n      time\n      extra_food\n      spaceId\n    }\n  }\n"]);return re=function(){return e},e}var ce=E()(re());function oe(){var e=Object(f.a)(["\n  mutation UpdateEntry($id: String!, $time: Int, $extra_food: Int) {\n    updateEntry(id: $id, time: $time, extra_food: $extra_food) {\n      id\n      time\n      extra_food\n    }\n  }\n"]);return oe=function(){return e},e}var ie=E()(oe());function le(){var e=Object(f.a)(["\n  mutation RemoveEntry($id: String!) {\n    removeEntry(id: $id) {\n      message\n      removedId\n    }\n  }\n"]);return le=function(){return e},e}var ue=E()(le());function me(){var e=Object(f.a)(["\n  query getSpaces {\n    spaces {\n      id\n      display_name\n    }\n  }\n"]);return me=function(){return e},e}var se=E()(me());function de(){var e=Object(f.a)(["\n  mutation CreateEntry($spaceId: String!, $time: Int!) {\n    createEntry(spaceId: $spaceId, time: $time) {\n      id\n      time\n      extra_food\n    }\n  }\n"]);return de=function(){return e},e}var fe=E()(de()),pe=Object(D.a)(function(e){return{appBar:{backgroundColor:"#3e4451"},avatar:{margin:15,width:40,height:40},toolbar:{justifyContent:"space-between",height:70},title:{margin:15},fab:{position:"fixed",bottom:e.spacing(2),right:e.spacing(2),zIndex:2},listWrapper:{marginTop:e.spacing(2)}}});var Ee=function(e){var t=e.match,a=e.profile,n=pe(),c=t.params.id,o=Object(b.a)(ne,{variables:{spaceId:c}}),l=o.loading,u=o.data,m=o.error,f=!l&&!m,p=Object(g.a)(fe,{refetchQueries:["getEntries"]}),E=Object(i.a)(p,2),j=E[0],D=E[1],$=D.loading,z=D.error,A=f&&u.entries.slice().sort(function(e,t){return t.time-e.time}),R=f&&A.reverse().reduce(function(e,t){if(e.length>0){var a=e[e.length-1];return[].concat(Object(d.a)(e),[Object(s.a)({},t,{meantime:U(new Date(1e3*t.time),new Date(1e3*a.time))})])}return[Object(s.a)({},t,{meantime:null})]},[]).reverse();if(R.length>0){var T=R[0],W=new Date(1e3*T.time),F=W.getHours(),q=F>=21||F<3?240:210;R.unshift({id:"future",time:Math.round(Object(te.a)(W,q)/1e3),extra_food:0,meantime:null,isSuggested:!0})}var H=R&&R.reduce(function(e,t){var a=Object(ee.a)(new Date(1e3*t.time)).getTime();return e[a]=e[a]||[],e[a].push(t),e},{});return r.a.createElement(r.a.Fragment,null,(m||z)&&r.a.createElement(M,{message:m||z}),r.a.createElement(v.a,{className:n.appBar},r.a.createElement(h.a,{disableGutters:!0,className:n.toolbar},r.a.createElement(O.a,{variant:"h5",className:n.title},"Food time"),r.a.createElement(y.a,{alt:"Profile picture",src:a.imageUrl,className:n.avatar}))),r.a.createElement(h.a,{className:n.toolbar}),r.a.createElement(x.a,{className:n.listWrapper,maxWidth:"sm"},r.a.createElement(N.a,{variant:"extended",color:"primary","aria-label":"delete",className:n.fab,onClick:function(){return j({variables:{time:Math.round(Date.now()/1e3),spaceId:c}})},disabled:$},r.a.createElement(w.a,{className:n.extendedIcon}),"New feeding"),!l&&!m&&r.a.createElement(k.a,null,!l&&u&&u.entries.length>0&&r.a.createElement(Z,{groupedEntries:H}),!l&&u&&0===u.entries.length&&r.a.createElement(I.a,null,r.a.createElement(S.a,null,r.a.createElement(C.a,{primary:"Click the button to start measuring intervals"})))),l&&r.a.createElement(_.a,null)))};var be=function(e){var t=e.history,a=Object(b.a)(se),n=a.loading,c=a.data;return a.error,r.a.createElement(x.a,{maxWidth:"sm"},n&&r.a.createElement(_.a,null),!n&&r.a.createElement(k.a,null,r.a.createElement(I.a,null,c.spaces.map(function(e){return r.a.createElement(S.a,{key:e.id,onClick:function(){return a=e.id,void t.push("/space/".concat(a));var a}},r.a.createElement(C.a,null,e.display_name))}))))},ge=a(99),ve=Object(D.a)(function(e){return{root:{position:"relative",minHeight:40},loader:{position:"absolute",backgroundColor:"white",top:-3,bottom:-5,left:0,right:0,zIndex:1}}}),he=function(e){var t=e.onLogin,a=ve(),c=function(e){t(e)},o=Object(n.useState)(!0),l=Object(i.a)(o,2),u=l[0],m=l[1];return Object(n.useEffect)(function(){var e=setTimeout(function(){m(!1)},1500);return function(){return clearTimeout(e)}}),r.a.createElement(r.a.Fragment,null,r.a.createElement("header",{className:"App-header"}),r.a.createElement("div",{className:a.root},u&&r.a.createElement("div",{className:a.loader},r.a.createElement(_.a,null)),r.a.createElement(ge.GoogleLogin,{clientId:"299114443733-g59vv11262camtp97hiv99sjh0qr3b9i.apps.googleusercontent.com",buttonText:"Login",onSuccess:c,onFailure:c,isSignedIn:!0,cookiePolicy:"single_host_origin"})))},Oe=a(102),ye=a(101),je=a(67),we=a(66),ke=a(100),xe=a(187),Ne=a(192),Ie=a(188),Se=a(68),Ce=a.n(Se),_e=a(193);function De(e){var t=null,a=!1;return function(){for(var n=arguments.length,r=new Array(n),c=0;c<n;c++)r[c]=arguments[c];a?t=function(){return e.apply(void 0,r)}:function e(n){a=!0,n().then(function(){if(a=!1,null!=t){var n=t;t=null,e(n)}})}(function(){return e.apply(void 0,r)})}}var $e=Object(D.a)(function(e){return Object(_e.a)({root:{padding:e.spacing(3,5)}})});var ze=function(e){var t=e.match.params.id,a=Object(b.a)(ce,{variables:{id:t}}),c=a.loading,o=a.data,l=o&&o.entry.spaceId,d=Object(g.a)(ue,{variables:{id:t},update:function(e,t){var a=t.data.removeEntry,n=null;try{n=e.readQuery({query:ne,variables:{spaceId:l}})}catch(r){}n&&e.writeQuery({query:ne,variables:{spaceId:l},data:{entries:n.entries.filter(function(e){return e.id!==a.removedId})}})}}),f=Object(i.a)(d,2),p=f[0],E=f[1].data,v=Object(n.useState)(null),h=Object(i.a)(v,2),y=h[0],j=h[1],I=Object(n.useState)(null),S=Object(i.a)(I,2),C=S[0],D=S[1],$=Object(m.b)(),z=Object(n.useCallback)(De(function(e){return $.mutate({mutation:ie,variables:Object(s.a)({id:t},e)})}),[$,t]);null!==y||c||j(new Date(1e3*o.entry.time)),null!==C||c||D(o.entry.extra_food);var A,M=function(e){j(e),z({time:Math.round(e.getTime()/1e3)})},R=$e();return E?r.a.createElement(u.a,{to:"/space/".concat(l)}):r.a.createElement(r.a.Fragment,null,r.a.createElement("header",{className:"App-header"},!c&&r.a.createElement(O.a,null,P(y)," ",(A=y,Object(G.a)(new Date(A),"d MMM, yyyy")))),r.a.createElement(x.a,{maxWidth:"sm"},c?r.a.createElement(_.a,null):r.a.createElement(xe.a,{container:!0,spacing:2,direction:"row",justify:"center"},r.a.createElement(xe.a,{item:!0,xs:12,md:4},r.a.createElement(k.a,{className:R.root},r.a.createElement(O.a,{paragraph:!0},"Day"),r.a.createElement(N.a,{color:"primary","aria-label":"Add",size:"small",onClick:function(){return M(Object(we.a)(y,1))}},r.a.createElement(w.a,null)),r.a.createElement(N.a,{color:"primary","aria-label":"Remove",size:"small",onClick:function(){return M(Object(ke.a)(y,1))}},r.a.createElement(Ce.a,null)))),r.a.createElement(xe.a,{item:!0,xs:12,md:4},r.a.createElement(k.a,{className:R.root},r.a.createElement(O.a,{paragraph:!0},"Hours"),r.a.createElement(N.a,{color:"primary","aria-label":"Add",size:"small",onClick:function(){return M(Object(je.a)(y,1))}},r.a.createElement(w.a,null)),r.a.createElement(N.a,{color:"primary","aria-label":"Remove",size:"small",onClick:function(){return M(Object(ye.a)(y,1))}},r.a.createElement(Ce.a,null)))),r.a.createElement(xe.a,{item:!0,xs:12,md:4},r.a.createElement(k.a,{className:R.root},r.a.createElement(O.a,{paragraph:!0},"Minutes"),r.a.createElement(N.a,{color:"primary","aria-label":"Add",size:"small",onClick:function(){return M(Object(te.a)(y,5))}},r.a.createElement(w.a,null)),r.a.createElement(N.a,{color:"primary","aria-label":"Remove",size:"small",onClick:function(){return M(Object(Oe.a)(y,5))}},r.a.createElement(Ce.a,null)))),r.a.createElement(xe.a,{item:!0,xs:12,md:12},r.a.createElement(k.a,{className:R.root},r.a.createElement(O.a,{paragraph:!0},"Extra food - ",C,"ml"),r.a.createElement(Ne.a,{defaultValue:C,"aria-labelledby":"discrete-slider",valueLabelDisplay:"off",step:5,min:0,max:150,onChange:function(e,t){return function(e){D(e),z({extra_food:e})}(t)}}))),r.a.createElement(xe.a,{item:!0,xs:12,md:12},r.a.createElement(k.a,{className:R.root},r.a.createElement(O.a,{paragraph:!0},"Danger zone"),r.a.createElement(Ie.a,{variant:"contained",color:"secondary",onClick:p},"Delete"))))))},Ae=a(189),Me=Object(D.a)(function(e){return Object(_e.a)({root:{padding:e.spacing(5,2)}})}),Re=function(){var e=Me();return r.a.createElement(r.a.Fragment,null,r.a.createElement("header",{className:"App-header"},"ERROR 404"),r.a.createElement(x.a,{className:e.root,maxWidth:"sm"},r.a.createElement(O.a,{variant:"h5",paragraph:!0},"NOT FOUND"),r.a.createElement(O.a,{variant:"body"},"Go back to the ",r.a.createElement(Ae.a,{to:"/",component:l.b},"homepage"))))},Te=a(45),We=a(106),Fe=a(104),qe=a(103);function He(e){var t=Object(We.a)({uri:"https://papi.ertrzyiks.me/food-time"}),a=Object(qe.a)(function(t,a){var n=a.headers;return{headers:Object(s.a)({},n,{authorization:"Bearer ".concat(e())})}});return new Te.a({cache:new Fe.a({cacheRedirects:{Query:{entry:function(e,t,a){return(0,a.getCacheKey)({__typename:"Entry",id:t.id})}}}}),link:a.concat(t)})}a(142);var Le=function(e){var t=e.match,a=e.write,r=e.children,c=t.params.id;return Object(n.useEffect)(function(){a(c)},[a,c]),r};var Be=function(e){var t=e.storage,a=t.read,c=t.write,o=a("food-time-space-id"),s=Object(n.useState)(null),d=Object(i.a)(s,2),f=d[0],p=d[1];return Object(n.useEffect)(function(){var e=setInterval(function(){if(f)return f.reloadAuthResponse().then(function(e){c("food-time-token-id",e.id_token)})},3e5);return function(){return clearInterval(e)}},[c,f]),r.a.createElement("div",{className:"App"},r.a.createElement(l.a,null,r.a.createElement(u.d,null,f?r.a.createElement(m.a,{client:He(function(){return a("food-time-token-id")})},r.a.createElement(u.d,null,r.a.createElement(u.b,{exact:!0,path:"/select",render:function(e){return r.a.createElement(be,e)}}),r.a.createElement(u.b,{path:"/space/:id",render:function(e){return r.a.createElement(Le,{write:function(e){return c("food-time-space-id",e)},match:e.match},r.a.createElement(Ee,Object.assign({},e,{profile:f.profileObj})))}}),r.a.createElement(u.b,{path:"/edit/:id",render:function(e){return r.a.createElement(ze,e)}}),r.a.createElement(u.b,{exact:!0,path:"/"},o?r.a.createElement(u.a,{to:"/space/".concat(o)}):r.a.createElement(u.a,{to:"/select"})))):r.a.createElement(u.b,{path:"/",render:function(e){return r.a.createElement(he,Object.assign({},e,{onLogin:function(e){c("food-time-token-id",e.tokenId),p(e)}}))}}),r.a.createElement(u.b,{component:Re}))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(Be,{storage:{read:function(e){return JSON.parse(window.localStorage.getItem(e))},write:function(e,t){return window.localStorage.setItem(e,JSON.stringify(t))}}}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[110,1,2]]]);
//# sourceMappingURL=main.84a3eb22.chunk.js.map